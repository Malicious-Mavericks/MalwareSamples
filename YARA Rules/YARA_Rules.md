# Yara Rules for Labs 1 and 3

YARA rules were generated with the help of [YaraGenerator](https://github.com/Xen0ph0n/YaraGenerator). Additional changes were made to each generated file to improve the match. 

## Lab 1 
### Yara Rules for Lab01-01.exe

![Lab01-1 Yara Rule](../Images/YARA_Rule_Lab01-01.PNG)

### Results

![Lab01-1 Yara Rule Results](../Images/YARA_Rule_Lab01-01_results.PNG)

### Yara Rules for Lab01-01.dll

```yara
rule Lab01_01_2 {
   meta:
      description = "Chapter_1L - file Lab01-01.dll"
      author = "Alex Henner"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-08-03"
      hash1 = "f50e42c8dfaab649bde0398867e930b86c2a599e8db83b8260393082268f2dba"
   strings:
      $s1 = "SADFHUHF" fullword ascii /* score: '6.50'*/
      $s2 = "127.26.152.13" fullword ascii /* score: '6.00'*/
      $s3 = "141G1[1l1" fullword ascii /* score: '1.00'*/
      $s4 = "/0I0[0h0p0" fullword ascii /* score: '1.00'*/
      $s5 = "1Y2a2g2r2" fullword ascii /* score: '1.00'*/
   condition:
      uint16(0) == 0x5a4d and filesize < 500KB and
      all of them
}
```

### Result

![Lab01-01.dll Yara Rule](../Images/YARA_Rule_Lab01-01-dll.png)

### Yara Rules for Lab01-02

```
rule Lab01_02 {
   meta:
      description = "Chapter_1L - file Lab01-02.exe"
      author = "Alex Henner"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-08-03"
      hash1 = "c876a332d7dd8da331cb8eee7ab7bf32752834d4b2b54eaa362674a2a48f64a6"
   strings:
      $s1 = "MalService" fullword ascii /* score: '7.00'*/
      $s2 = "SystemTimeToFile" fullword ascii /* score: '7.00'*/
      $s3 = "http://w" fullword ascii /* score: '7.00'*/
      $s4 = "sHGL345" fullword ascii /* score: '5.00'*/
      $s5 = "ObjectU4" fullword ascii /* score: '5.00'*/
      $s6 = "warean" fullword ascii /* score: '5.00'*/
      $s7 = "Process" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.43'*/ /* Goodware String - occured 571 times */
      $s8 = "OpenMu$x" fullword ascii /* score: '4.00'*/
      $s9 = "*Waitab'r" fullword ascii /* score: '4.00'*/
      $s10 = "ysisbook.co" fullword ascii /* score: '4.00'*/
      $s11 = "CtrlDisp ch" fullword ascii /* score: '4.00'*/
      $s12 = "om#Int6net Explo!r 8FEI" fullword ascii /* score: '4.00'*/
      $s13 = "lB`.rd" fullword ascii /* score: '1.00'*/
      $s14 = "dlI37n" fullword ascii /* score: '1.00'*/
   condition:
      uint16(0) == 0x5a4d and filesize < 9KB and
      8 of them
}
```

### Result

![Lab01-02 Yara Rule](../Images/YARA_Rule_Lab01-02.png)

### Yara Rules for Lab01-03

```
rule Lab01_03 {
   meta:
      description = "Chapter_1L - file Lab01-03.exe"
      author = "Alex Henner"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-08-03"
      hash1 = "7983a582939924c70e3da2da80fd3352ebc90de7b8c4c427d484ff4f050f0aec"
   strings:
      $s1 = "_getmas" fullword ascii /* score: '6.00'*/
      $s2 = "!Windows Program" fullword ascii /* score: '4.00'*/
      $s3 = "}OLEAUTLA" fullword ascii /* score: '4.00'*/
      $s4 = "IMSVCRTT\"b" fullword ascii /* score: '4.00'*/
      $s5 = "ole32.vd" fullword ascii /* score: '1.00'*/
      $s6 = "|P2r3Us" fullword ascii /* score: '1.00'*/
   condition:
      uint16(0) == 0x5a4d and filesize < 10KB and
      all of them
}
```

### Results

![Lab01-03 Yara Rule](../Images/YARA_Rule_Lab01-03.png)

### Yara Rules for Lab01-04

```
rule Lab01_04 {
   meta:
      description = "Chapter_1L - file Lab01-04.exe"
      author = "Alex Henner"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-08-03"
      hash1 = "0fa1498340fca6c562cfa389ad3e93395f44c72fd128d7ba08579a69aaf3b126"
   strings:
      $s1 = "\\system32\\wupdmgr.exe" fullword ascii /* score: '24.00'*/
      $s2 = "\\system32\\wupdmgrd.exe" fullword ascii /* score: '24.00'*/
      $s3 = "http://www.practicalmalwareanalysis.com/updater.exe" fullword ascii /* score: '21.00'*/
      $s4 = "\\winup.exe" fullword ascii /* score: '16.00'*/
      $s5 = "SeDebugPrivilege" fullword ascii /* PEStudio Blacklist: priv */ /* score: '4.86'*/ /* Goodware String - occured 141 times */
      $s6 = "<not real>" fullword ascii /* score: '1.00'*/
   condition:
      uint16(0) == 0x5a4d and filesize < 100KB and
      all of them
}
```

### Results

![Lab01-04 Yara Rule](../Images/YARA_Rule_Lab01-04.png)

## Lab 3 

### Yara Rules for Lab03-01.exe
![Lab03-1 Yara Rule](../Images/YARA_Rule_Lab03-01.PNG)

### Results

![Lab03-1 Yara Rule Results](../Images/YARA_Rule_Lab03-01_results.PNG)

### Yara Rules for Lab03-02.exe

```
rule Lab03_02 {
   meta:
      description = "Chapter_3L - file Lab03-02.dll"
      author = "Alex Henner"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-08-03"
      hash1 = "5eced7367ed63354b4ed5c556e2363514293f614c2c2eb187273381b2ef5f0f9"
   strings:
      $x1 = "%SystemRoot%\\System32\\svchost.exe -k " fullword ascii /* score: '36.00'*/
      $x2 = "cmd.exe /c " fullword ascii /* score: '33.00'*/
      $s3 = "RegOpenKeyEx(%s) KEY_QUERY_VALUE error ." fullword ascii /* score: '18.00'*/
      $s4 = "Lab03-02.dll" fullword ascii /* score: '17.00'*/
      $s5 = "practicalmalwareanalysis.com" fullword ascii /* score: '17.00'*/
      $s6 = "RegOpenKeyEx(%s) KEY_QUERY_VALUE success." fullword ascii /* score: '15.00'*/
      $s7 = "dW5zdXBwb3J0" fullword ascii /* base64 encoded string 'unsupport' */ /* score: '14.00'*/
      $s8 = "GetModuleFileName() get dll path" fullword ascii /* score: '14.00'*/
      $s9 = "Y29ubmVjdA==" fullword ascii /* base64 encoded string 'connect' */ /* score: '14.00'*/
      $s10 = "OpenService(%s) error 1" fullword ascii /* score: '13.00'*/
      $s11 = "CreateService(%s) error %d" fullword ascii /* score: '13.00'*/
      $s12 = "OpenService(%s) error 2" fullword ascii /* score: '13.00'*/
      $s13 = "You specify service name not in Svchost//netsvcs, must be one of following:" fullword ascii /* score: '12.00'*/
      $s14 = "RegQueryValueEx(Svchost\\netsvcs)" fullword ascii /* score: '9.00'*/
      $s15 = "netsvcs" fullword ascii /* score: '8.00'*/
      $s16 = "serve.html" fullword ascii /* score: '7.00'*/
      $s17 = ":$:2:K:U:\\:l:" fullword ascii /* score: '7.00'*/
      $s18 = "uninstall success" fullword ascii /* score: '6.00'*/
      $s19 = "uninstall is starting" fullword ascii /* score: '6.00'*/
      $s20 = "Depends INA+, Collects and stores network configuration and location information, and notifies applications when this informatio" ascii /* score: '5.00'*/
   condition:
      uint16(0) == 0x5a4d and filesize < 70KB and
      1 of ($x*) and 4 of them
}
```

### Results

![Lab03-02 Yara Rule](../Images/YARA_Rule_Lab03-02.png)

### Yara Rules for Lab03-03.exe
![Lab03-3 Yara Rule](../Images/YARA_Rule_Lab03-03.PNG)

### Results

![Lab03-3 Yara Rule](../Images/YARA_Rule_Lab03-03_results.PNG)

### Yara Rules for Lab01-04.exe

```
rule Lab03_04 {
   meta:
      description = "Chapter_3L - file Lab03-04.exe"
      author = "Alex Henner"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2023-08-03"
      hash1 = "6ac06dfa543dca43327d55a61d0aaed25f3c90cce791e0555e3e306d47107859"
   strings:
      $s1 = "http://www.practicalmalwareanalysis.com" fullword ascii /* score: '17.00'*/
      $s2 = "%SYSTEMROOT%\\system32\\" fullword ascii /* score: '16.00'*/
      $s3 = " Manager Service" fullword ascii /* score: '7.00'*/
      $s4 = " HTTP/1.0" fullword ascii /* score: '7.00'*/
      $s5 = "UPLOAD" fullword ascii /* PEStudio Blacklist: strings */ /* score: '5.00'*/ /* Goodware String - occured 2 times */
      $s6 = "DOWNLOAD" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.97'*/ /* Goodware String - occured 29 times */
      $s7 = "command.com" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.91'*/ /* Goodware String - occured 91 times */
      $s8 = "COMSPEC" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.75'*/ /* Goodware String - occured 247 times */
      $s9 = "k:%s h:%s p:%s per:%s" fullword ascii /* score: '4.00'*/
      $s10 = "SOFTWARE\\Microsoft \\XPS" fullword ascii /* score: '4.00'*/
      $s11 = "\"WWSh(" fullword ascii /* score: '3.00'*/ /* Goodware String - occured 2 times */
      $s12 = "/c del " fullword ascii /* score: '1.00'*/
      $s13 = " >> NUL" fullword ascii /* score: '1.00'*/
      $s14 = "6KRich" fullword ascii /* score: '1.00'*/
   condition:
      uint16(0) == 0x5a4d and filesize < 200KB and
      8 of them
}
```

### Results

![Lab03-04 Yara Rule](../Images/YARA_Rule_Lab03-04.png)