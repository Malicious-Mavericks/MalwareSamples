# Lab 3: Dynamic Analysis
## Lab 3-1
### Questions
1. What are this malware’s imports and strings?
2. What are the malware’s host-based indicators?
3. Are there any useful network-based signatures for this malware? If so, what are they?
### Imports and strings
Checking PEiD to see if the binary is packed.

![lab03-01 peid packed](../../Images/lab03-01_packed.png)

The binary does appear to be packed with PEncyrpt 3.1

Checking PEStudio for imports and strings:

![lab03-01 pestudio imports](../../Images/lab03-01_imports.png)

![lab03-01 pestudio strings1](../../Images/lab03-01_strings1.png)

![lab03-01 pestudio strings2](../../Images/lab03-01_strings2.png)

The lack of imports is another indicator that this binary was packed. Some especially interesting strings include: CONNECT, HTTP, www.practicalmalwareanalysis.com, registry keys like Software\Microsoft\Current\Verson\Run, admin, VideoDriver, and WinMX32. 


### Host-based indicators

Looking into the strings we noticed a few registry keys including `SOFTWARE\Microsoft\Windows\CurrentVersion\Run` which means the program is trying to get persistance. The `vmx32to64.exe` is more likely the name of the malware.

### Network-based indicators

Looking at [CONNECT](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/CONNECT) for http, we can see that it is an HTTP method for creating two-way communications as a tunnel. The URL that is present in the strings is www[.]practicalmalwareanalysis[.]com

## Lab 3-2
### Questions
1. How can you get this malware to install itself?
2. How would you get this malware to run after installation?
3. How can you find the process under which this malware is running?
4. Which filters could you set in order to use procmon to glean information?
5. What are the malware’s host-based indicators?
6. Are there any useful network-based signatures for this malware?
### Installation

Looking at the exports in PEStudio we see ordinal values followed with the names. We are assuming the name Install will help us install the malware. Before running any malware, we will take a shot with RegShot and start ProcessExplorer as well as Procmon to record what happens after the program is installed.

![lab03-02 exports](../../Images/lab03-02_exports.png)

![lab03-02 process explorer](../../Images/lab03-02_procexp.png)

![lab03-02 Regshot](../../Images/lab03-02_Regshot2.PNG)

Running the following command

`C:\>rundll32.exe Lab03-02.dll, installA`

### Running

Taking another shot after installing the malware, we are able to compare added and removed keys/values. This indicates that a IPRIP service needs to be started. This also shows the executable file that the `.dll` file depends on to launch is `svchost.exe`. 

![lab03-02 Regshot](../../Images/lab03-02_Regshot.PNG)

We can then run the malware by starting the service with this command:

`C:\>net start IPRIP`


### Network-based indicators

The textbook recommends faking a network with ApateDNS and Netcat. However, ApateDNS is not easily found for windows XP. We are instead attempting to fake a network with FakeNet.

![lab03-02 ProcessExplorer](../../Images/lab03-02_ProcessExplorer.png)

![lab03-02 ProcessExplorer](../../Images/lab03-02_ProcessExplorer2.png)

![lab03-02 FakeNet1](../../Images/lab03-02_FakeNet.png)

![lab03-02 FakeNet2](../../Images/lab03-02_FakeNet1.png)

There were 28,145 events that occured in the short time that I was capturing with Procmon. To narrow these results down to a reasonable amount, I filtered with the PID obtained for ProcessExplorer: `984`. 

![lab03-02 Procmon](../../Images/lab03-02_Procmon.png)

The malware service was started with `C:\>net start IPRIP`. An attempt to stop this service was made with `C:\>net stop IPRIP`. It appeared to be succesful as there was no more network traffic recorded. 

![lab03-02 FakeNet3](../../Images/lab03-02_FakeNet2.png)

### Imports and strings



### Host-based indicators



### Network-based indicators

## Lab 3-3
## Lab 3-4


